<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.project.mapper.master.ProjectFieldMapper">
    <resultMap id="BaseResultMap" type="com.project.entity.ProjectField">
        <id column="id_project_field" property="idProjectField" jdbcType="INTEGER"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="key" property="key" jdbcType="VARCHAR"/>
        <result column="type" property="type" jdbcType="VARCHAR"/>
		<result column="mandatory" property="mandatory" jdbcType="BOOLEAN"/>
		<result column="length" property="length" jdbcType="INTEGER"/>
		<result column="ref" property="ref" jdbcType="VARCHAR"/>
		<result column="mult" property="mult" jdbcType="BOOLEAN"/>
		<result column="sort" property="sort" jdbcType="INTEGER"/>
		<result column="position" property="position" jdbcType="INTEGER"/>
	</resultMap>
    <sql id="Base_Column_List">
       id_project_field, `name`, `key`, `type`, `mandatory`, `length`, `ref`, `mult`, `sort`, `position`
	</sql>
	<select id="selectProjectFieldById" resultType="com.project.entity.ProjectField">
		SELECT
			pf.`id_project_field` AS 'idProjectField',
			pf.`name`,
			pf.`key`,
			pf.`type`,
			pf.`mandatory`,
			pf.`length`,
			pf.`ref`,
			pf.`mult`,
			pf.`sort`,
			pf.`position`
			FROM project_field_values pfv
			LEFT JOIN project_field pf ON pf.`id_project_field` = pfv.`id_project_field`
			WHERE pfv.`id_project` = #{idProject,jdbcType=INTEGER}
			ORDER BY sort
	</select>
	<insert id="insertSeleative" parameterType="com.project.entity.ProjectField"
			useGeneratedKeys="true" keyProperty="idProjectField">
		insert into project_field(`name`,`type`,`position`)
		values (
			#{name},
			#{type},
			#{position}
		)
	</insert>
	<insert id="addProjectFields">
		insert into project_field(`name`,`key`, `type`, `sort`, `position`)
		values (
		<foreach collection="projectField" item="item" separator=";" >
		#{item.name},
		#{item.key},
		#{item.type},
		#{item.sort},
		#{item.position}
		</foreach>
		)
	</insert>
    <select id="selectAll" resultMap="BaseResultMap">
		SELECT
			 <include refid="Base_Column_List"/>
		FROM project_field
		WHERE `sort` IS NOT NULL
		ORDER BY `sort`
	</select>
</mapper>